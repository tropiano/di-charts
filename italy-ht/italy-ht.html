<!DOCTYPE html >
<head>
  <meta charset="utf-8">
  <title>D3 Page Template</title>
  <script type="text/javascript" src="../d3/d3.js"></script>
  
  <style type="text/css">
    
    div.bar {
    display: inline-block;
    width: 20px;
    height: 75px;   /* We'll override height later */
    background-color: teal;
    margin-right: 2px;
    }

    text {
    font-family: sans-serif;
    font-size: 12px;
    fill: white;
    }
	
	#textbox {
	  position: absolute;
	  top: 100px;
	  left: 400px;
	  width: 275px;
	  height: 100px;
	}

	#textbox text p {
	  font-family: Arial, Helvetica;
	  font-size: 1.8em;
	  margin: 0;
	}
	
    
  </style>
</head>
<body>
<div id="textbox"></div>
	
  <script type="text/javascript">

    
   var w = 600;
   var h = 800;

   var svg = d3.select("body")
   	.append("svg")
   	.attr("width", w)
   	.attr("height", h);

   var projection = d3.geo.albers()
   	.center([0, 41])
   	.rotate([347, 0])
   	.parallels([35, 45])
   	.scale(3500)
   	.translate([w / 2, h / 2]);

   var path = d3.geo.path()
   	.projection(projection);

   var color = d3.scale.quantize()
   	.range(["#ffffe5", "#fff7bc", "#fee391", "#fec44f", "#fe9929", "#ec7014", "#cc4c02", "#993404", "#662506"]);

    //open the teams file
   d3.csv("teamsht.csv", function(data) {
   	color.domain([
   		d3.min(data, function(d) {
   			return d.value;
   		}),
   		d3.max(data, function(d) {
   			return d.value;
   		})
   	]);

   	d3.json("italy.json", function(json) {
   		for (var i = 0; i < data.length; i++) {
   			//Grab state name
   			var dataState = data[i].region;
   			//Grab data value, and convert from string to float
   			var dataValue = parseFloat(data[i].value);

   			//Find the corresponding state inside the GeoJSON
   			for (var j = 0; j < json.features.length; j++) {

   				var jsonState = json.features[j].properties.name;

   				if (dataState == jsonState) {
   					//Co	py the data value into the JSON
   					json.features[j].properties.value = dataValue;
   					//Stop looking through the JSON
   					break;

   				}
   			}
   		};

   		svg.selectAll("path")
   			.data(json.features)
   			.enter()
   			.append("path")
   			.attr("d", path)
   			.style("fill", function(d) {
   				//Get data value
   				var value = d.properties.value;
   				if (value) {
   					//If value exists	
   					return color(value);
   				} else {
   					//If value is undefined
   					return "#ccc";
   				}
   			})
			.on("mouseover", function(d) {
				

				var prop = d.properties;

		        var string = "<p><strong>Region</strong> " + prop.name + "</p>";
				string += "<p><strong>Number of teams:</strong> " + prop.value + "</p>";

				d3.select("#textbox")
					.html("")
					.append("text")
					.html(string)
			})

			.on("mouseout", function(d) {
				
				d3.select("#textbox")
					.html("")
					.append("text")
					.html("")
			})
   	});
   });
					    
	</script>
  
</head>
</html>
